<p><strong>Jamrock</strong> is a web framework for NodeJS that use server-side components to tie logic and presentation together.</p>
<p>Most syntax is based on the <a href="https://github.com/htmlx-org/HTMLx">HTMLx</a> specification (which is used by <a href="https://svelte.dev/">Svelte</a>),
however its behavior may not be the same, as the components are meant to run completely on the back-end.</p>
<p>Behavior will try to follow what <a href="https://hotwired.dev/">Hotwire</a> and <a href="https://remix.run/">Remix</a> do,
if JavaScript is enabled on the client-side all pages rendered will be progressively enhanced.</p>
<h2 id="files-directories">Files &amp; directories</h2>
<p>We recommend you to use an <strong>app</strong> folder to group the required stuff for your web pages:</p>
<pre class="hljs">
â”œâ”€â”€ app
â”‚  â”œâ”€â”€ assets
â”‚  â”‚  â”œâ”€â”€ scripts
â”‚  â”‚  â””â”€â”€ styles
â”‚  â”œâ”€â”€ client
â”‚  â””â”€â”€ pages
â”œâ”€â”€ routes
â””â”€â”€ shared
      â””â”€â”€ server.js
</pre>

<p>Depending on its location, the resulting routes will be:</p>
<ul>
<li><code>app/pages/my/$area.html</code> &rarr; <code>/my/:area</code> (page)</li>
<li><code>routes/$user.edit.js</code> &rarr; <code>/:user/edit</code> (api)</li>
<li><code>routes/test/index.js</code> &rarr; <code>/test/*</code> (api)</li>
<li><code>app/pages/index.html</code> &rarr; <code>/*</code> (page)</li>
</ul>
<p>Your <strong>assets</strong> can contain other sources as well,
they are pre-processed and only <code>**/assets/scripts/*.js</code> files are bundled:</p>
<ul>
<li><code>app/assets/about.md</code> &rarr; <code>/about</code> (render)</li>
<li><code>app/assets/index.pug</code> &rarr; <code>/</code> (render)</li>
<li><code>app/assets/styles/home.less</code> &rarr; <code>/styles/home.css</code> (render)</li>
<li><code>app/assets/scripts/app.js</code> &rarr; <code>/scripts/app.js</code> (bundle)</li>
</ul>
<blockquote><p><svg width="16" height="16"><use xlink:href="#icon-code"></use></svg> The code you&#39;ll need in <code>shared/server.js</code>:</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-keyword">const</span> server = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;jamrock/server&#x27;</span>);

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = server.<span class="hljs-title function_">init</span>();
</code></pre>
</blockquote><p>Now you have two options to create routes: either on <code>app/pages</code> for <code>.html</code> components, or in <code>routes</code> for <code>.js</code> handlers.</p>
<p>In the other hand, all files you place inside <code>app/assets</code> will be pre-rendered and its final output will be served.</p>
<p>The <strong>client</strong> folder is reserved for those components that might be used on the client-side only.</p>
<h3 id="route-handlers">Route handlers</h3>
<p>Files inside <strong>routes</strong> are function modules, or objects, exposing some functions to act as request handlers, i.e.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">// app/routes/example/index.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function"><span class="hljs-params">conn</span> =&gt;</span> <span class="hljs-string">`
  &lt;h1&gt;<span class="hljs-subst">${conn.req.originalUrl}</span>&lt;/h1&gt;
`</span>;
</code></pre>
<p>Returned value determines the response type, otherwise you should use the <code>conn</code> argument to set a response.</p>
<pre class="hljs"><code class="lang-js"><span class="hljs-comment">// app/routes/logout.js</span>
<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = {
  <span class="hljs-attr">as</span>: <span class="hljs-string">&#x27;logout_path&#x27;</span>,
  <span class="hljs-title function_">DELETE</span>(<span class="hljs-params">conn</span>) {
    conn.<span class="hljs-title function_">delete_session</span>([<span class="hljs-string">&#x27;user_auth&#x27;</span>]);
    conn.<span class="hljs-title function_">put_flash</span>(<span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&#x27;Good bye!&#x27;</span>);
    conn.<span class="hljs-title function_">redirect</span>(conn.<span class="hljs-property">routes</span>.<span class="hljs-title function_">login_page</span>());
  },
};
</code></pre>
<p>Named methods matching <code>/^(GET|PUT|POST|PATCH|DELETE)/</code> will be used to sub-route the requested path.</p>
<blockquote><p><svg width="16" height="16"><use xlink:href="#icon-pin"></use></svg> The <code>as</code> property is used to make reference to other routes, so <code>conn.routes.logout_path()</code> will work as expected.</p>
</blockquote><h2 id="usage-principles">Usage principles</h2>
<p>Static pages are a good solution for most people, later you can sprinkle JavaScript to improve the usability.</p>
<pre class="hljs"><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">import</span> { session, put_session } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jamrock/conn&#x27;</span>;

  <span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> value = session.<span class="hljs-property">name</span> || <span class="hljs-string">&#x27;world&#x27;</span>;

  <span class="hljs-attr">$</span>: name = value.<span class="hljs-title function_">toUpperCase</span>();
  <span class="hljs-attr">$</span>: <span class="hljs-title function_">put_session</span>(<span class="hljs-string">&#x27;name&#x27;</span>, value);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>Hello, {name}.<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">bind:value</span> /&gt;</span>
</code></pre>
<ol>
<li>In the example above, we&#39;re capitalizing the <code>value</code> variable when it changes, inside the <code>$:</code> label.</li>
<li>We also update the session through <code>put_session()</code> because the session object is read-only.</li>
<li>The template renders the actual <code>name</code> and listen for changes on the <code>&lt;input&gt;</code>&#39;s <code>value</code>.</li>
</ol>
<h3 id="what-will-happen-you-might-ask-%F0%9F%A4%94">What will happen you might ask? ðŸ¤”</h3>
<p>On every change on the <code>&lt;input&gt;</code> field a <code>PATCH</code> request is made, in response, the framework
execute and render the requested component and then it sends the changes back to the browser.</p>
<p>On the client-side, Jamrock will patch the actual DOM with the response&#39;s changes, including stylesheets and executing any given scripts.</p>
<p>However, this example will not work if you disable JavaScript on your browser...</p>
<h3 id="working-without-the-necessity-of-javascript-%F0%9F%91%80">Working without the necessity of JavaScript ðŸ‘€</h3>
<p>In order to fix the previous example, we need to solve this client-side issue: triggering actions on user input.</p>
<p>The solution is pretty simple actually, might not be as reactive than listening for <code>oninput</code> events, but it&#39;ll work:</p>
<pre class="hljs"><code class="lang-diff"><span class="hljs-deletion">-&lt;input bind:value /&gt;</span>
<span class="hljs-addition">+&lt;form @patch&gt;</span>
<span class="hljs-addition">+  &lt;input bind:value /&gt;</span>
<span class="hljs-addition">+  &lt;input type=&quot;submit&quot; /&gt;</span>
<span class="hljs-addition">+&lt;/form&gt;</span>
</code></pre>
<p>Jamrock will enhance the <code>&lt;form&gt;</code> to include the appropriate <code>method</code> and hidden fields to handle the <code>PATCH</code> request.</p>
<p>Also, an element that can <code>submit</code> the form is required (it can be hidden), that will trigger the request to the page as expected.</p>
<p>The only downside on this approach is that you&#39;ll lost the focus on the <code>&lt;input&gt;</code> field if you press <kbd>ENTER</kbd> while you&#39;re typing. ðŸ˜…</p>
<h2 id="conclussions">Conclussions</h2>
<p>Working this way you&#39;ll enable more users consuming your web-pages without charge them with the penalty of the complexity of your app:</p>
<ul>
<li>Your code may stay complex and so, but on the server-side, where you won&#39;t hurt the final user experience.</li>
<li>Also, using server-side rendering have a lot of benefits for caching, distribution, search-engine optimization, etc.</li>
</ul>
